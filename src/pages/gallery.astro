---
import Markdown from "@components/misc/Markdown.astro";
import InteractiveGalleryView from "../components/gallery/InteractiveGalleryView.svelte";
import { siteConfig } from "../config";
import MainGridLayout from "../layouts/MainGridLayout.astro";
import { getGalleryEntries } from "../utils/gallery-utils";

const entries = await getGalleryEntries();

// 预渲染所有 Content 组件
const entryContents = new Map();
for (const entry of entries) {
	const { Content } = await entry.render();
	entryContents.set(entry.id, Content);
}
---

<MainGridLayout
  title="画廊"
  banner={siteConfig.banner.src}
  description="精选摄影作品"
  lang="zh"
>
  <div class="gallery-container px-8 py-6 mb-2 mx-2 md:mx-0">
    <div class="mb-4">
      <h1 class="font-bold text-4xl p-2 dark:text-neutral-50 transition">画廊</h1>
      <p class="pl-2 text-slate-600 dark:text-slate-400">我的精选摄影作品</p>
    </div>

    <!-- 隐藏的 Content 渲染容器，用于为每个 entry 生成 HTML -->
    <div id="gallery-content-templates" class="hidden">
      {entries.map((entry) => {
        const Content = entryContents.get(entry.id);
        return (
          <div data-gallery-id={entry.id} class="gallery-content-template">
            <Markdown class="">
              <Content />
            </Markdown>
          </div>
        );
      })}
    </div>

    <InteractiveGalleryView {entries} client:load />
  </div>
</MainGridLayout>

<style>
  .gallery-container {
    @apply overflow-hidden rounded-[var(--radius-xxlarge)] border border-black/10 bg-[var(--card-bg)] transition dark:border-white/10;
    max-width: 800px;
  }

  @media (min-width: 1024px) {
    .gallery-container {
      margin-left: 10%;
      margin-right: auto;
    }
  }
  @media (max-width: 640px) {
    .gallery-container {
      @apply p-4;
    }
  }
</style>