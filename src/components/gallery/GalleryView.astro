---
import type { GalleryEntry } from "../../utils/gallery-utils";
import InteractiveGalleryView from "./InteractiveGalleryView.svelte";

interface Props {
	entries: GalleryEntry[];
}

const { entries } = Astro.props;

// 预渲染所有文章内容,用于 Svelte 组件使用
const entryContents = new Map<string, any>();
for (const entry of entries) {
	const { Content } = await entry.render();
	entryContents.set(entry.id, Content);
}
---

<!-- 使用 Svelte 组件处理所有交互逻辑 -->
<InteractiveGalleryView {entries} client:load />

<!-- 隐藏的 Content 渲染容器,用于为每个 entry 生成 HTML -->
<div id="gallery-content-templates" class="hidden">
	{entries.map((entry) => {
		const Content = entryContents.get(entry.id);
		return (
			<div data-gallery-id={entry.id} class="gallery-content-template">
				<div class="prose prose-slate dark:prose-invert prose-base !max-w-none custom-md">
					<Content />
				</div>
			</div>
		);
	})}
</div>